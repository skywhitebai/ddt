<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sky.ddt.dao.custom.CustomWorkTaskMapper">
    <resultMap id="listWorkTaskMap"
               type="com.sky.ddt.dto.workTask.resp.ListWorkTaskResp"
               extends="com.sky.ddt.dao.generate.WorkTaskMapper.ResultMapWithBLOBs">
        <result column="dealUserRealName" property="dealUserRealName"/>
        <result column="chargeUserRealName" property="chargeUserRealName"/>
        <result column="salesGroupName" property="salesGroupName"/>
        <result column="salesGroupUserRealNames" property="salesGroupUserRealNames"/>
    </resultMap>
    <select id="listWorkTask"
            resultMap="listWorkTaskMap">
        SELECT
        <include refid="com.sky.ddt.dao.generate.WorkTaskMapper.Base_Column_List"/>,
        <include refid="com.sky.ddt.dao.generate.WorkTaskMapper.Blob_Column_List" />,
        (select real_name  from user u where u.user_id =wt.deal_user_id) dealUserRealName,
        (select real_name  from user u where u.user_id =wt.charge_user_id) chargeUserRealName,
        (select group_name  from sales_group sg where sg.id =wt.sales_group_id) salesGroupName,
        (select GROUP_CONCAT(real_name SEPARATOR ',')   from user u,sales_group_user sgu where u.user_id=sgu.user_id and sgu.sales_group_id =wt.sales_group_id) salesGroupUserRealNames
        from work_task wt
        <where>
            <trim prefix="(" suffix=")" prefixOverrides="and">
                <if test="title != null and title!=''">and title like concat('%',#{title},'%')</if>
                <if test="workTaskNo != null and workTaskNo!=''">and work_task_no like concat('%',#{workTaskNo},'%')</if>
                <if test="status != null ">and status = #{status}</if>
                <if test="chargeUserId != null ">and charge_user_id = #{chargeUserId}</if>
                <if test="dealUserId != null ">and deal_user_id = #{dealUserId}</if>
                <if test="salesGroupId != null ">and sales_group_id = #{salesGroupId}</if>
            </trim>
        </where>
        order by wt.create_time asc
    </select>
</mapper>